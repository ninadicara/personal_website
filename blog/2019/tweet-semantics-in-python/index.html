<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>

  Nina  Di Cara


  | Tweet Semantics in Python

</title>
<meta name="description" content="Website and projects
">

<!-- Open Graph -->


<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" integrity="sha512-RO38pBRxYH3SoOprtPTD86JFOclM51/XTIdEPh5j8sj4tp8jmQIx26twG52UaLi//hQldfrh7e51WzP9wuP32Q==" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.xyz/repo/jwarby/jekyll-pygments-themes/master/github.css" />

<!-- Styles -->

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒ»</text></svg>">

<link rel="stylesheet" href="/assets/css/main.css">
<link rel="canonical" href="/blog/2019/tweet-semantics-in-python/">

<!-- JQuery -->
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>


<!-- Theming-->

<script src="/assets/js/theme.js"></script>
<script src="/assets/js/dark_mode.js"></script>






    
<!-- MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex: {
      tags: 'ams'
    }
  };
</script>
<script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js"></script>
<script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>


  </head>

  <body class="fixed-top-nav sticky-bottom-footer">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
    <div class="container">
      
      <a class="navbar-brand title font-weight-lighter" href="/">
       <span class="font-weight-bold">Nina</span>   Di Cara
      </a>
      
      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/blog/">
              blog
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/projects/">
                projects
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                publications
                
              </a>
          </li>
          
          
          
            <div class = "toggle-container">
              <a id = "light-toggle">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
              </a>
            </div>
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="container mt-5">
      

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Tweet Semantics in Python</h1>
    <p class="post-meta">March 6, 2019</p>
  </header>

  <article class="post-content">
    <p>One of my PhD aims will be around analysing data from Tweets using machine learning/ NLP (natural language processing, <strong>not</strong> neuro-linguistic programming â€“ social work problems).</p>

<p>Iâ€™m aiming to achieve this in Python (partly to learn new things, and because it appears to be the industry standard) and so I thought Iâ€™d have a go at building a mini-project where I download tweets from Twitter around a certain topic and categorise them as being â€˜positiveâ€™ or â€˜negativeâ€™ based on simple semantic analysis. This is my first foray into the world of APIs, semantics and rate-limiting â€“ it was educational.</p>

<h2 id="initial-thoughts-on-python">Initial thoughts on Pythonâ€¦</h2>

<p>As it was my first use of Python for anything beyond experimenting in a Jupyter Notebook, it was also the first time Iâ€™ve had to really think about how to structure my code properly. While Iâ€™ve done some programming in Java, itâ€™s been a while and I found the class/function structure in Python a bit different â€“ there donâ€™t seem to be getters and setters in quite the same way and classes are used differentlyâ€¦ Though I do respect that fact that Python is a lot more concise AND the white space parsing at least means that everyoneâ€™s code is formatted properly (in theory).</p>

<p>The biggest bugbear I have with Python at the moment though is the poor documentation for so many packages/modules (and why is there no standard terminology??), and the nightmare of conflicting dependencies. At least with R I know all the packages I use are documented in the same place, in the same format so itâ€™s easy to find answers when I need them. As well as this Iâ€™ve never had problems with dependencies in R, though it can happen.</p>

<p>I canâ€™t see myself becoming a Python evangelist, and Iâ€™m really not convinced (as some seem to be) that Python is the be-all and end-all of programming languages.</p>

<p>I digress.</p>

<p>What I came up with</p>

<h2 id="1-setting-up-the-api">1. Setting up the API</h2>

<p>First of all I had to sign up to Twitter Dev and register myself to get the keys and tokens needed to run Tweepy.</p>

<p>I chose Tweepy because it seemed pretty straightforward to do the things I wanted to do, the documentation was well laid out and easy to find, and there were lots of examples of it online.</p>

<p>In a poor attempt to bring some structure to my code I put pretty much everything in functions. As a result, the first function literally returns an API object.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">api_setup</span><span class="p">():</span>

<span class="s">""" Uses keys and tokens from dev_logins file to setup API access. Returns Tweepy API object """</span>

<span class="c1">#Use imported keys/tokens to set up API. 
</span><span class="n">auth</span> <span class="o">=</span> <span class="n">tweepy</span><span class="p">.</span><span class="n">OAuthHandler</span><span class="p">(</span><span class="n">consumer_key</span><span class="p">,</span> <span class="n">consumer_secret</span><span class="p">)</span>
<span class="n">auth</span><span class="p">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">access_token_secret</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">tweepy</span><span class="p">.</span><span class="n">API</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>

<span class="k">return</span> <span class="n">api</span>
</code></pre></div></div>

<p>So far so good.</p>

<h2 id="2-mining-for-tweets">2. Mining for Tweets</h2>

<p>I decided to go for 1000 tweets, as I wasnâ€™t really sure what I was rate-limited to. I decided to allow a search-term argument so I could re-purpose the function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">collect_tweets</span><span class="p">(</span><span class="n">searchterm</span><span class="p">):</span>

<span class="s">""" Collects 1000 tweets matching searchterm through the api and returns a dataframe with a column of tweets """</span>


<span class="n">text_lst</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">time_lst</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweepy</span><span class="p">.</span><span class="n">Cursor</span><span class="p">(</span><span class="n">api_setup</span><span class="p">().</span><span class="n">search</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">searchterm</span><span class="p">).</span><span class="n">items</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
<span class="n">text_lst</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">time_lst</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">tweet</span><span class="p">.</span><span class="n">created_at</span><span class="p">)</span>

<span class="c1">#Turn list into pandas dataframe object
</span><span class="n">tweets</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">tweets</span><span class="p">[</span><span class="s">'text'</span><span class="p">]</span> <span class="o">=</span> <span class="n">text_lst</span>
<span class="n">tweets</span><span class="p">[</span><span class="s">'time'</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_lst</span>

<span class="k">return</span> <span class="n">tweets</span>
</code></pre></div></div>

<p>I introduce two empty lists, then for each result found through the api I append the actual text of the tweet and the time/date stamp to each list. This leaves me with with two lists of 1000 items, one of tweet text and one of the time and date of the corresponding tweet. Lovely.</p>

<p>If you try to just append each tweet (without calling a specific attribute such as â€˜textâ€™) you will get all the attributes of the tweet in a dictionary of Java-Script Object Notation, or JSON. Unless youâ€™re familiar with JSON or need it for some reason then I would recommend calling the specific attributes you need.</p>

<p>Twitter Dev has a very handy page where it lists all the attributes you can call off a tweet object in a nice table. 10/10 would bookmark.</p>

<p>If youâ€™re wondering, the â€˜Cursorâ€™ part of the Tweepy search avoids having to iterate though â€˜pagesâ€™ of tweets. See the documentation here.</p>

<h2 id="3-data-cleaning">3. Data Cleaning</h2>

<p>This was the more interesting part of my mini-project. Having studied data-mining before I knew Iâ€™d need to get rid of the stop words in the tweets, but how to also get rid of the annoying links, hashtags and punctuation?</p>

<p>Iâ€™ve been learning about regular expressions/regex recently and found that you can achieve removal of special characters and links using regex which is super handy and uses much less computational time than writing a Python function to search through for explicit characters.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">remove_specials</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>

<span class="s">""" For tweets in a Pandas dataframe under a column called 'text', will remove special characters, hyperlinks"""</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">:</span>
<span class="n">msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'text'</span><span class="p">]</span>
<span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span>
<span class="c1">#Regex statement to remove hyperlinks and special characters
</span><span class="n">msg</span> <span class="o">=</span> <span class="s">' '</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s">"(@[A-Za-z0-9]+)|([^0-9A-Za-z </span><span class="se">\t</span><span class="s">])|(\w+:\/\/\S+)"</span><span class="p">,</span> <span class="s">" "</span><span class="p">,</span> <span class="n">msg</span><span class="p">).</span><span class="n">split</span><span class="p">())</span>
<span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'text'</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span>

<span class="k">return</span> <span class="n">df</span>


<span class="k">def</span> <span class="nf">remove_stops</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>

<span class="s">""" For tweets in a Pandas dataframe under a column called 'text' will remove all stop words from 'many_stop_words' package """</span>

<span class="n">stop_words</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">get_stop_words</span><span class="p">(</span><span class="s">'en'</span><span class="p">))</span> 
<span class="n">stop_words</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'rt'</span><span class="p">)</span> <span class="c1">#add RT as a stopword because it does not add value to the dataset.
</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">:</span>

<span class="c1">#split message into list of individual words
</span><span class="n">msg</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'text'</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
<span class="n">newmsg</span> <span class="o">=</span> <span class="s">""</span>

<span class="c1">#for each word in the list, if it's not in stop_words then keep in by adding to newmsg. 
</span><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>
<span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">:</span>
<span class="n">newmsg</span> <span class="o">=</span> <span class="n">newmsg</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">word</span>

<span class="c1">#reassign value of df cell as newmsg which has no stop words 
</span><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'text'</span><span class="p">]</span> <span class="o">=</span> <span class="n">newmsg</span>

<span class="k">return</span> <span class="n">df</span>
</code></pre></div></div>

<p>Another decision to make was whether to just have one function which cleaned data, but I felt that splitting it down into the separate operations was better form, and then I just needed another function that called them.</p>

<h2 id="4-semantics">4. Semantics</h2>

<p>The last thing to do was then to apply semantic analysis. I chose TextBlob as it was simple to apply to the data and was recommended on a few sites. In reality Iâ€™m looking at libraries such as LIWC for more advanced semantic analysis, and eventually hoping to move beyond semantics into applying machine learning.</p>

<p>The function takes a dataframe as an argument, then adds two new columns. It fills those columns with the corresponding tweet polarity and subjectivity scores from TweetBlob for each tweet. Simples!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">sentiment_analysis</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>

<span class="s">""" Given dataframe with tweets in 'text' column, returns dataframe with sentiment polarity and subjectivity for each tweet """</span>

<span class="n">df</span><span class="p">[</span><span class="s">"Polarity"</span><span class="p">]</span> <span class="o">=</span> <span class="s">""</span>
<span class="n">df</span><span class="p">[</span><span class="s">"Subjectivity"</span><span class="p">]</span> <span class="o">=</span> <span class="s">""</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">:</span> 
<span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Polarity'</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextBlob</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'text'</span><span class="p">]).</span><span class="n">sentiment</span><span class="p">.</span><span class="n">polarity</span>
<span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'Subjectivity'</span><span class="p">]</span> <span class="o">=</span> <span class="n">TextBlob</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s">'text'</span><span class="p">]).</span><span class="n">sentiment</span><span class="p">.</span><span class="n">subjectivity</span>

<span class="k">return</span> <span class="n">df</span>
</code></pre></div></div>

<h2 id="5-to-do-next">5. To do nextâ€¦</h2>

<p>The next thing Iâ€™m trying to do is present the polarity data in a bar chart showing the number of â€˜positiveâ€™, â€˜negativeâ€™ and â€˜neutralâ€™ tweets about the chosen topic, and maybe then trying to do some nice time-based visualization.</p>

<p>E.G â€“ Did the number of positive and negative tweets around Islam change before and after the reporting of Shamima Begumâ€™s bid to return to the UK? (There have been anecdotal reports of an increase in Islamophobia associated with the aggressive reporting).</p>

<p>Unfortunately this wonâ€™t be too easy to find out since there is a limit on the tweets I am able to collect and over what time frame I can collect them â€“ still trying to understand this rate limiting thing!</p>

  </article>

  

</div>

    </div>

    <!-- Footer -->

    
<footer class="sticky-bottom mt-5">
  <div class="container">
    &copy; Copyright 2021 Nina  Di Cara.
    
    
    
  </div>
</footer>



  </body>

  <!-- Bootsrap & MDB scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.4/umd/popper.min.js" integrity="sha512-eUQ9hGdLjBjY3F41CScH3UX+4JDSI9zXeroz7hJ+RteoCaY+GP/LDoM8AO+Pt+DRFw3nXqsjh9Zsts8hnYv8/A==" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha512-M5KW3ztuIICmVIhjSqXe01oV2bpe248gOxqmlcYrEzAvws7Pw3z6BK0iGbrwvdrUQUhi3eXgtxp5I8PDo9YfjQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" integrity="sha512-Mug9KHKmroQFMLm93zGrjhibM2z2Obg9l6qFG2qKjXEXkMp/VDkI4uju9m4QKPjWSwQ6O2qzZEnJDEeCw0Blcw==" crossorigin="anonymous"></script>

  
<!-- Mansory & imagesLoaded -->
<script defer src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script defer src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script defer src="/assets/js/mansory.js" type="text/javascript"></script>


  


<!-- Medium Zoom JS -->
<script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
<script src="/assets/js/zoom.js"></script>


<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


</html>
